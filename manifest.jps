{
    "jpsType": "install",
    "jpsVersion": "0.99",
    "application": {
        "name": "Wordpress Cluster",
        "categories": ["apps/clustered-dbs", "apps/popular", "apps/clusters"],
        "description": "Get your highly available and scalable clustered solution for WordPress, the extremely popular open source CMS and blogging tool. This package is designed to ensure the load tracking and distribution, as well as automatic adjusting the amount of allocated resources according to it.",
        "logo": "https://download.jelastic.com/public.php?service=files&t=3da2215839f82aa50d3d961271cd1cb9&download",
        "env": {
            "topology": {
                "nodes": [{
                    "image": "jelastic/mysql:5.7.14",
                    "count": 2,
                    "cloudlets": 8,
                    "nodeGroup": "sqldb",
                    "displayName": "Database"
                }, {
                    "image": "devbeta/nginxphp:1.10.1-php-7.0.10",
                    "count": 1,
                    "cloudlets": 8,
                    "nodeGroup": "cp",
                    "links": "sqldb:DB",
                    "volumes": ["/var/www/webroot/ROOT"],
                    "volumeMounts": {
                        "/var/www/webroot/ROOT": {
                            "readOnly": false,
                            "sourcePath": "/data",
                            "sourceNodeGroup": "storage"
                        }
                    },
                    "displayName": "AppServer"
                }, {
                    "image": "jelastic/storaged",
                    "cloudlets": 8,
                    "nodeGroup": "storage",
                    "displayName": "Storage"
                }, {
                    "image": "devbeta/nginxbalancer:1.10.1",
                    "extip": true,
                    "count": 1,
                    "cloudlets": 8,
                    "nodeGroup": "bl",
                    "displayName": "Load balancer"
                }]
            }
        },
        "globals": {
            "PATH": "https://raw.githubusercontent.com/jelastic-jps/wordpress-cluster/dev",
            "DB_USER": "jelastic-${fn.random}",
            "DB_PASS": "${fn.password(20)}",
            "ADMIN_PASSWD": "${fn.password(20)}",
            "WP_TITLE": "Hello World"
        },
        "onInstall": [{
            "log": "DB Cluster Setup"
        }, {
            "installJps": {
                "jps": "https://raw.githubusercontent.com/sych74/mysql-cluster/master/multimaster-configuration.jps",
                "settings": {
                    "db_user": "${globals.DB_USER}",
                    "db_pass": "${globals.DB_PASS}"
                }
            }
        }, {
            "log": "Download and Unpack Content"
        }, {
            "cmd[storage]": ["wget -qO- 'https://wordpress.org/wordpress-4.7.3.tar.gz' | tar xz -C /tmp && mv /tmp/wordpress/* /data"]
        }, {
            "installJps": {
                "jps": "${globals.PATH}/addons/setup-wordpress.jps",
                "settings": {
                    "db_host": "DB_1",
                    "db_user": "${globals.DB_USER}",
                    "db_pass": "${globals.DB_PASS}",
                    "admin_passwd": "${globals.ADMIN_PASSWD}",
                    "wp_title": "${globals.WP_TITLE}"
                }
            }
        }]
    }
}
